<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <!-- Meta Descripción para SEO -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="En CellMarket encontrarás los mejores celulares de marcas reconocidas como iPhone, Motorola, Redmi, Xiaomi, Oppo, Pixel y más. Calidad garantizada y precios increíbles. ¡Descúbrelo ahora en CellMarket!">
    <meta name="keywords" content="CellMarket, celulares, iPhone, Motorola, Redmi, Xiaomi, Oppo, Pixel, teléfonos inteligentes, smartphones, comprar celulares, laptops, tecnología">
    <meta name="author" content="CellMarket SAC">
    
    <!-- Open Graph para Redes Sociales -->
    <meta property="og:title" content="CellMarket - Los Mejores Celulares al Mejor Precio">
    <meta property="og:description" content="Descubre una amplia variedad de celulares de las mejores marcas: iPhone, Motorola, Xiaomi, Oppo, Redmi, Pixel y más. Calidad garantizada en CellMarket.">
    <meta property="og:image" content="https://i.ibb.co/3kJn5bP/image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://cellmarket-sac.web.app">
    <meta property="og:type" content="website">

    <!-- Twitter Card para Mejor Visualización -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CellMarket - Tu Tienda de Celulares de Confianza">
    <meta name="twitter:description" content="Explora nuestra selección de celulares de las marcas más populares: iPhone, Motorola, Xiaomi y más. ¡Entra ya a CellMarket!">
    <meta name="twitter:image" content="https://i.ibb.co/3kJn5bP/image.png">


    <!-- Favicon -->
    <link rel="icon" href="https://cellmarket-sac.web.app/favicon.ico" type="image/x-icon">
    
    <!-- Schema.org para SEO Local -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Store",
      "name": "CellMarket",
      "image": "https://i.ibb.co/3kJn5bP/image.png",
      "description": "Venta de celulares y laptops. Descubre los mejores smartphones de marcas como iPhone, Motorola, Redmi, Xiaomi, Oppo, Pixel y más.",
      "url": "https://cellmarket-sac.web.app",
      "address": {
        "@type": "PostalAddress",
        "addressLocality": "Perú"
      },
      "openingHours": "Mo-Fr 09:00-18:00",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+51-XXXXXXXXX",
        "contactType": "Customer Service"
      }
    }
    </script>
    <title>CellMarket - Venta de Celulares de las Mejores Marcas</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-O+IT6IXFbqv7+TQ1rNqpAUuaNCWyBO6UVBd8i4OhS9nF6VfT8GNdTu5/c1LsiBfFl8J7LblrBYHY/u3XfHOo9w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        /* Variables de color y tipografía */
        :root {
            --color-fondo: #f9f9f9;
            --color-blanco: #ffffff;
            --color-gris-claro: #eeeeee;
            --color-gris: #333333;
            --color-gris-oscuro: #555555;
            --color-primario: #007BFF; /* Azul moderno */
            --color-secundario: #FF4081; /* Rosa acentuado */
            --color-texto: #333333;
            --color-texto-claro: #ffffff;
            --color-hover: #FFA000; /* Naranja para hover */
            --fuente-principal: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: var(--fuente-principal);
            background: var(--color-fondo);
            color: var(--color-texto);
        }

        .container {
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 0 1rem;
        }

        header {
            position: fixed; 
            top: 0; 
            width: 100%; 
            z-index: 1000;
            background: #0b0f2b;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }

        .header-content {
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 1rem 2rem;
        }

        .logo {
            font-weight: bold; 
            font-size: 1.5rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            color: var(--color-primario);
        }

        .logo img {
            height: 55px;
        }

        nav {
            flex: 1; 
            display: flex; 
            justify-content: center; 
            gap: 1.5rem;
        }

        nav a {
            color: var(--color-primario); 
            text-decoration: none; 
            display: inline-flex; 
            align-items: center; 
            gap:0.3rem; 
            font-size:0.95rem; 
            transition: color 0.2s ease;
        }

        nav a:hover {
            color: var(--color-hover);
        }

        .cart-button {
            cursor: pointer; 
            background: var(--color-secundario); 
            padding: 0.6rem 1rem; 
            border-radius: 50px; 
            display: flex; 
            align-items: center; 
            gap:0.5rem; 
            transition: background 0.2s ease; 
            font-size: 0.9rem; 
            color: var(--color-texto-claro);
        }

        .cart-button:hover {
            background: #e0356f; 
        }

        .content-offset {
            margin-top: 80px;
        }

        .banner {
            position: relative; 
            height: 300px; 
            margin-bottom: 2rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: var(--color-texto-claro); 
            overflow: hidden; 
            text-shadow: 0px 0px 5px rgba(0,0,0,0.7);
        }

        .banner .banner-image-container {
            position: absolute; 
            top:0; left:0; 
            width: 100%; 
            height: 100%; 
            z-index: -1;
        }

        .banner .banner-image-container img {
            position: absolute; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            opacity: 0; 
            transition: opacity 1s ease;
        }

        .banner .banner-image-container img.active {
            opacity: 1;
        }

        .banner h1 {
            font-size: 3rem; 
            margin: 0; 
            text-align: center; 
            z-index: 1;
            background: rgba(0,0,0,0.4); 
            padding: 0.5rem 1rem; 
            border-radius: 5px;
        }

        .filters {
            display: flex; 
            flex-wrap: wrap; 
            align-items: center; 
            justify-content: center;
            padding: 1rem; 
            gap: 1rem; 
            background: var(--color-blanco); 
            border-bottom: 1px solid #ccc;
            position: sticky; 
            top: 80px; 
            z-index: 999;
        }

        .filters input, .filters select {
            padding: 0.5rem; 
            font-size: 1rem; 
            border-radius: 4px; 
            border: 1px solid #ccc;
            outline: none;
        }

        .filters input:focus, .filters select:focus {
            border-color: #999; 
        }

        .description-section {
            background: var(--color-blanco); 
            padding: 2rem 1rem;
            border-top: 1px solid #ccc; 
            border-bottom: 1px solid #ccc;
            text-align: center;
        }

        .description-section p {
            max-width: 600px; 
            margin: 0 auto; 
            font-size: 1rem; 
            line-height: 1.6;
            color: var(--color-gris-oscuro); 
            margin-bottom: 2rem; 
            white-space: pre-line;
        }

        /* Añadimos saltos de línea en el texto para mayor legibilidad */
        /* Ejemplo de texto formateado: */
        /* "Por qué pagar más por lo mismo?\n
           Con nosotros, obtienes smartphones de última generación sin sacrificar tu presupuesto.\n
           Encuentra el dispositivo perfecto para ti y disfruta de las mejores ofertas.\n
           RUC: 20609762005" */

        .location-section {
            background: var(--color-blanco); 
            padding: 2rem 1rem;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 1rem; 
            border-bottom: 1px solid #ccc;
        }

        .location-info {
            display: flex; 
            align-items: center; 
            gap:0.5rem; 
            font-size:1rem; 
            color: var(--color-texto); 
            justify-content: center;
        }

        .location-info i {
            color: var(--color-primario);
            font-size:1.5rem;
        }

        .products {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
            gap: 1.5rem; 
            padding: 2rem 0;
        }

        .product {
            border: 1px solid #ddd; 
            border-radius: 8px; 
            text-align: center; 
            padding: 1rem; 
            background: var(--color-blanco);
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
            transition: box-shadow 0.3s ease, transform 0.3s ease; 
            position: relative; 
            cursor: pointer;
        }

        .product:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            transform: translateY(-3px);
        }

        .product img {
            max-width: 100%; 
            max-height: 150px; 
            object-fit: cover; 
            margin-bottom: 0.5rem; 
            border-radius: 4px;
        }

        .product h3 {
            font-size: 1rem; 
            margin: 0.5rem 0;
        }

        .product .details {
            font-size: 0.85rem; 
            color: #666; 
            margin-bottom: 0.5rem; 
            line-height: 1.3;
        }

        .product .details div {
            margin-bottom: 0.25rem;
        }

        .price-container {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0.5rem 0;
        }

        .original-price {
            text-decoration: line-through; 
            color: #999; 
            margin-bottom: 0.25rem; 
            font-size: 0.9rem;
        }

        .promotional-price {
            color: red; 
            font-weight: bold; 
            font-size: 1.1rem;
        }

        .no-promo-price {
            margin: 0.5rem 0; 
            font-weight: bold; 
            font-size: 1rem;
        }

        .product button {
            padding: 0.5rem 1rem; 
            background: var(--color-primario); 
            color: var(--color-texto-claro); 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            margin-top: 0.5rem; 
            display: flex; 
            align-items: center; 
            gap:0.5rem; 
            transition: background 0.2s ease;
        }

        .product button:hover {
            background: var(--color-hover);
        }

        /* Animaciones skeleton mientras carga */
        .product.skeleton { 
            animation: skeleton-loading 1.5s linear infinite alternate; 
            background: var(--color-gris-claro); 
        }
        .skeleton-image, .skeleton-button, .skeleton-text { 
            background: #ddd; 
            border-radius: 4px; 
        }
        .skeleton-image { 
            height: 150px; 
            margin-bottom: 0.5rem; 
        }
        .skeleton-text { 
            height: 15px; 
            margin-bottom: 0.5rem; 
        }
        .skeleton-text.short { width: 40%; }
        .skeleton-text.med { width: 70%; }
        .skeleton-button { 
            width: 60%; 
            height: 30px; 
            margin: 0.5rem auto 0; 
            border-radius:50px; 
        }

        @keyframes skeleton-loading {
            0% { background-color: #ddd; }
            100% { background-color: #e0e0e0; }
        }

        /* Modal de producto */
        .product-modal-overlay {
            position: fixed; 
            top:0; left:0; 
            width:100%; 
            height:100vh; 
            background: rgba(0,0,0,0.5);
            display: none; 
            justify-content:center; 
            align-items:center; 
            z-index:2000;
        }

        .product-modal-overlay.open { display: flex; }

        .product-modal {
            background: var(--color-blanco); 
            border-radius: 8px; 
            max-width: 600px; 
            width: 90%; 
            padding: 2rem; 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
        }

        .product-modal img {
            max-width: 200px; 
            max-height: 200px; 
            object-fit: cover; 
            margin-bottom: 1rem; 
            border-radius:4px; 
        }

        .product-modal h2 {
            margin: 0.5rem 0; 
            font-size: 1.5rem; 
            text-align: center;
        }

        .modal-details {
            font-size: 0.9rem; 
            color: #666; 
            margin: 1rem 0; 
            text-align:left; 
            width:100%; 
            line-height:1.5;
        }

        .modal-details ul {
            list-style: disc; 
            padding-left:20px; 
        }

        .modal-details ul li { margin-bottom:0.5rem; }

        .modal-price { 
            font-weight: bold; 
            font-size: 1.2rem; 
            margin: 1rem 0; 
            text-align:center; 
            width:100%;
        }

        .product-modal button:hover { 
            background: var(--color-hover); 
        }

        .close-product-modal {
            position: absolute; 
            top: 1rem; 
            right:1rem; 
            background: none; 
            border:none; 
            font-size:1.5rem; 
            cursor: pointer; 
            color: var(--color-texto);
        }

        .close-product-modal:hover { 
            color:#666; 
        }

        /* Modal del carrito */
        .cart-modal {
            position: fixed; 
            top: 0; 
            right: 0; 
            width: 320px; 
            height: 100vh; 
            background: var(--color-blanco);
            box-shadow: -2px 0 10px rgba(0,0,0,0.1); 
            transform: translateX(100%); 
            transition: transform 0.3s ease; 
            display: flex; 
            flex-direction: column; 
            z-index: 1000;
        }

        .cart-modal.open { transform: translateX(0); }

        .cart-modal-header {
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 1rem; 
            background: var(--color-primario); 
            color: var(--color-texto-claro);
        }

        .cart-modal-header h2 { margin: 0; font-size: 1.2rem; }

        .close-cart { 
            background: none; 
            border: none; 
            color: var(--color-texto-claro); 
            font-weight: bold; 
            font-size: 1.5rem; 
            cursor: pointer; 
        }

        .close-cart:hover { 
            color: var(--color-hover); 
        }

        .cart-items { 
            flex: 1; 
            overflow-y: auto; 
            padding: 1rem; 
        }

        .cart-item {
            display: flex; 
            align-items: center; 
            margin-bottom: 1rem; 
            justify-content: space-between;
        }

        .cart-item img {
            width: 50px; 
            height: 50px; 
            object-fit: cover; 
            margin-right: 1rem; 
            border-radius: 4px;
        }

        .cart-item-info { 
            display: flex; 
            flex-direction: column; 
            flex:1;
        }

        .cart-item p { 
            margin: 0; 
            font-size: 0.9rem; 
        }

        .remove-item {
            background: none; 
            border: none; 
            font-size: 1.2rem; 
            color: var(--color-gris); 
            cursor: pointer; 
        }

        .remove-item:hover { 
            color: red; 
        }

        .cart-footer {
            padding: 1rem; 
            border-top: 1px solid #ccc;
        }

        .cart-footer button {
            width: 100%; 
            padding: 0.5rem; 
            background: var(--color-primario); 
            color: var(--color-texto-claro);
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            display:flex; 
            align-items:center; 
            justify-content:center; 
            gap:0.5rem; 
            transition: background 0.2s ease;
        }

        .cart-footer button:hover { 
            background: var(--color-hover); 
        }

        .toast {
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: var(--color-gris); 
            color: var(--color-texto-claro);
            padding: 0.75rem 1rem; 
            border-radius: 4px; 
            opacity: 0; 
            transition: opacity 0.3s ease; 
            z-index: 3000; 
            font-size: 0.9rem;
        }

        .toast.show { 
            opacity: 1; 
        }

        .flying-img {
            position: fixed; 
            width: 50px; 
            height: 50px; 
            object-fit: cover; 
            border-radius: 4px; 
            z-index: 2000;
            transition: transform 1s ease-in-out; 
            pointer-events: none;
        }

        .contact-section {
            background: var(--color-blanco); 
            padding: 2rem 1rem; 
            border-top: 1px solid #ccc;
        }

        .contact-section h2 {
            text-align: center; 
            margin-bottom: 1rem; 
            font-size: 1.8rem; 
            color: var(--color-texto);
        }

        .contact-info {
            display: flex; 
            justify-content: center; 
            gap: 1rem; 
            max-width: 400px; 
            margin: 0 auto;
        }

        .icon-circle {
            display: inline-flex; 
            justify-content: center; 
            align-items: center;
            width: 50px; 
            height: 50px; 
            border-radius: 50%; 
            color: #fff; 
            font-size: 1.5rem; 
            transition: transform 0.3s, background-color 0.3s;
        }

        .icon-circle:hover { 
            transform: scale(1.1); 
        }

        .icon-circle.tiktok { background-color: #222222; }
        .icon-circle.whatsapp { background-color: #20b954; }
        .icon-circle.facebook { background-color: #E46345; }

        .contact-section p {
            text-align: center; 
            font-size:0.9rem; 
            color: var(--color-texto); 
            margin-top: 1rem;
        }

        footer {
            background: var(--color-gris-claro); 
            padding: 1rem; 
            text-align: center; 
            font-size:0.9rem; 
            color: var(--color-texto);
        }

        @media (max-width: 768px) {
            nav { display: none; }
            .logo { font-size:1.2rem; }
            .products { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
        }

        @media (max-width: 480px) {
            .filters { flex-direction: column; }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <a href="login.html">
                    <img src="https://i.ibb.co/7bCRxj3/image.png" alt="Logo de cellmarket">
                </a>
            </div>
            <nav>
                <a href="#inicio"><i class="fas fa-home"></i> Inicio</a>
                <a href="#productos"><i class="fas fa-tags"></i> Productos</a>
                <a href="#contacto"><i class="fas fa-envelope"></i> Contacto</a>
            </nav>
            <div class="cart-button" id="cartButton">
                <i class="fas fa-shopping-cart"></i> Carrito (0)
            </div>
        </div>
    </header>
    
    <div class="content-offset" id="inicio"></div>

    <div class="banner">
        <div class="banner-image-container">
            <img src="https://www.fexcortes.com/wp-content/uploads/2023/12/estrategias-para-incrementar-ventas-en-navidad.jpg" class="active" alt="Imagen Promocional Navideña">
            <img src="https://i.ibb.co/GP5kT6N/image.png" alt="Imagen Promocional 2">
            <img src="https://fabrikbrands.com/wp-content/uploads/Samsung-Logo-History-5-864x540.png" alt="Logo Samsung">
            <img src="https://cdn.worldvectorlogo.com/logos/motorola-6.svg" alt="Logo Motorola">
            <img src="https://logolook.net/wp-content/uploads/2022/10/Xiaomi-Logo.png" alt="Logo Xiaomi">
            <img src="https://media.beehiiv.com/cdn-cgi/image/fit=scale-down,quality=80/uploads/asset/file/0bea3124-209e-4793-8ac2-d5224ee85d81/image.png" alt="Logo adicional">
            <img src="https://upload.wikimedia.org/wikipedia/commons/c/c5/Sony_logos.JPG" alt="Logo Sony">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/1e/JBL-Logo.svg/1200px-JBL-Logo.svg.png" alt="Logo JBL">
        </div>
        <h1>Grandes ofertas, pequeños precios</h1>
    </div>

    <div class="filters container" id="productos">
        <input type="text" id="searchInput" placeholder="Buscar productos...">
        <select id="brandFilter">
            <option value="">Todas las marcas</option>
            <option value="APPLE">APPLE</option>
            <option value="SAMSUNG">SAMSUNG</option>
            <option value="SONY">SONY</option>
            <option value="REDMI">REDMI</option>
        </select>
    </div>

    <!-- Sección de Descripción de la Página -->
    <div class="description-section">
        <p>Por qué pagar más por lo mismo?\n
           Con nosotros, obtienes smartphones de Última Generación sin sacrificar tu presupuesto.\n
           Encuentra el dispositivo perfecto para ti y descubre que cambiar de teléfono es más económico que nunca.\n
           RUC: 20609762005</p>
    </div>

    <!-- Sección de Ubicación -->
    <div class="location-section">
        <div class="location-info">
            <i class="bi bi-geo-alt-fill"></i>
            <span>Av. Raul Ferrero cdra. 1205, La Molina 15024, Perú</span>
        </div>
    </div>

    <section class="products" id="productsSection"></section>

    <div class="cart-modal" id="cartModal">
        <div class="cart-modal-header">
            <h2>Carrito</h2>
            <button class="close-cart" id="closeCartBtn">×</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <button id="checkoutBtn"><i class="fas fa-credit-card"></i> Finalizar Compra</button>
        </div>
    </div>

    <div class="contact-section" id="contacto">
        <h2>Contáctanos</h2>
        <div class="contact-info">
            <a href="https://www.tiktok.com/@cell_market_sac?_t=8s44MTtNbaY&_r=1" target="_blank" class="icon-circle tiktok" title="TikTok">
                <i class="bi bi-tiktok" style="font-size: 2rem; color: white;"></i>
            </a>
            <a href="https://wa.me/+51938759195" target="_blank" class="icon-circle whatsapp" title="WhatsApp">
                <i class="bi bi-whatsapp" style="font-size: 2rem; color: white;"></i>
            </a>
            <a href="https://www.instagram.com/cell_market_sac/" target="_blank" class="icon-circle facebook" title="Instagram">
                <i class="bi bi-instagram" style="font-size: 2rem; color: white;"></i>
            </a>
        </div>
        <p>Correo electrónico: cellmarket@soporte.com</p>
    </div>

    <footer>
        <p>© 2024 cellmarket. Todos los derechos reservados.</p>
    </footer>

    <div id="toast" class="toast">Producto agregado al carrito!</div>

    <div class="product-modal-overlay" id="productModalOverlay">
        <div class="product-modal">
            <button class="close-product-modal" id="closeProductModalBtn">×</button>
            <img id="modalProductImg" src="" alt="Producto">
            <h2 id="modalProductName"></h2>
            <div class="modal-details" id="modalProductDetails"></div>
            <p class="modal-price" id="modalProductPrice"></p>
            <button id="modalAddToCartBtn"><i class="fas fa-cart-plus"></i> Agregar al carrito</button>
        </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-analytics.js";
      import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "cellmarket-sac.firebaseapp.com",
        projectId: "cellmarket-sac",
        storageBucket: "cellmarket-sac.firebasestorage.app",
        messagingSenderId: "279357654056",
        appId: "1:279357654056:web:058b1ff71551f7e698611d",
        measurementId: "G-42VBCX4JMF"
      };

      const app = initializeApp(firebaseConfig);
      getAnalytics(app);
      const db = getFirestore(app);

      const productsSection = document.getElementById('productsSection');
      const searchInput = document.getElementById('searchInput');
      const brandFilter = document.getElementById('brandFilter');
      const productModalOverlay = document.getElementById('productModalOverlay');
      const modalProductImg = document.getElementById('modalProductImg');
      const modalProductName = document.getElementById('modalProductName');
      const modalProductDetails = document.getElementById('modalProductDetails');
      const modalProductPrice = document.getElementById('modalProductPrice');
      const modalAddToCartBtn = document.getElementById('modalAddToCartBtn');
      const closeProductModalBtn = document.getElementById('closeProductModalBtn');
      const cartModal = document.getElementById('cartModal');
      const cartItemsContainer = document.getElementById('cartItems');
      const checkoutBtn = document.getElementById('checkoutBtn');
      const closeCartBtn = document.getElementById('closeCartBtn');
      const cartButton = document.getElementById('cartButton');
      const toast = document.getElementById('toast');

      let allProducts = [];
      let currentModalProduct = null;
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      let isLoading = true;

      const showToast = (message) => {
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      };

      const saveCartToLocalStorage = () => localStorage.setItem('cart', JSON.stringify(cart));

      function updateCartDOM() {
        cartItemsContainer.innerHTML = '';
        cart.forEach((item, i) => {
          const priceNumber = Number(item.price);
          const cartItem = document.createElement('div');
          cartItem.className = 'cart-item';
          cartItem.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-item-info">
                <p><strong>${item.name}</strong></p>
                <p>$${priceNumber.toFixed(2)}</p>
            </div>
            <button class="remove-item" data-index="${i}">×</button>
          `;
          cartItemsContainer.appendChild(cartItem);
        });
        cartButton.innerHTML = `<i class="bi bi-cart-plus"></i> Carrito (${cart.length})`;
      }

      const addToCart = (name, price, image) => {
        cart.push({ name, price, image });
        saveCartToLocalStorage();
        updateCartDOM();
        showToast("Producto agregado al carrito!");
      };

      function showSkeleton() {
        for (let i = 0; i < 8; i++) {
          const skeletonCard = document.createElement('div');
          skeletonCard.className = 'product skeleton';
          skeletonCard.innerHTML = `
            <div class="skeleton-image"></div>
            <div class="skeleton-text"></div>
            <div class="skeleton-text med"></div>
            <div class="skeleton-button"></div>
          `;
          productsSection.appendChild(skeletonCard);
        }
      }

      function formatDescription(description) {
        if (!description) return '<div>Sin detalles adicionales</div>';
        const lines = description.split('\n').map(l => l.trim()).filter(l => l);
        let html = '';
        const listItems = [];

        lines.forEach(line => {
          if (line.startsWith('- ')) {
            listItems.push(line.slice(2));
          } else {
            html += `<p>${line}</p>`;
          }
        });

        if (listItems.length > 0) {
          html += '<ul>';
          listItems.forEach(item => { html += `<li>${item}</li>`; });
          html += '</ul>';
        }

        return html || '<div>Sin detalles adicionales</div>';
      }

      function renderProducts(productsToRender) {
        productsSection.innerHTML = '';
        if (productsToRender.length === 0) {
          productsSection.innerHTML = "<p>No hay productos que coincidan con tu búsqueda.</p>";
          return;
        }

        productsToRender.forEach((p) => {
          const imgURL = p.image || 'https://via.placeholder.com/150';
          const priceNumber = Number(p.price);
          const promoNumber = p.promotionalPrice ? Number(p.promotionalPrice) : null;
          const priceHTML = promoNumber && promoNumber > 0 
            ? `<div class="price-container"><span class="original-price">$${priceNumber.toFixed(2)}</span><span class="promotional-price">$${promoNumber.toFixed(2)}</span></div>`
            : `<p class="no-promo-price">$${priceNumber.toFixed(2)}</p>`;

          const productEl = document.createElement('div');
          productEl.className = 'product';
          const originalIndex = allProducts.indexOf(p);
          productEl.setAttribute('data-index', originalIndex);

          productEl.innerHTML = `
              <img src="${imgURL}" alt="${p.title}" class="product-img">
              <h3>${p.title}</h3>
              <div class="details">
                ${p.sagitario ? `<div><strong>Marca/Línea:</strong> ${p.sagitario}</div>` : ''}
                ${p.description ? `<div><strong>Descripción:</strong> ${p.description.replace(/\n/g, '<br>')}</div>` : ''}
              </div>
              ${priceHTML}
              <button data-name="${p.title}" data-price="${(promoNumber && promoNumber > 0) ? promoNumber : priceNumber}" data-image="${imgURL}">
                <i class="fas fa-cart-plus"></i> Agregar
              </button>
          `;
          productsSection.appendChild(productEl);
        });
      }

      function applyFilters() {
        if (isLoading) return;
        let results = [...allProducts];

        const searchText = searchInput.value.toLowerCase();
        if (searchText) {
          results = results.filter(prod =>
            (prod.title?.toLowerCase().includes(searchText) || prod.description?.toLowerCase().includes(searchText))
          );
        }

        const selectedBrand = brandFilter.value;
        if (selectedBrand) {
          results = results.filter(prod => prod.sagitario?.toUpperCase() === selectedBrand);
        }

        renderProducts(results);
      }

      function openProductModal(product) {
        currentModalProduct = product;
        modalProductImg.src = product.image || 'https://via.placeholder.com/150';
        modalProductName.textContent = product.title;
        let detailsContent = product.sagitario ? `<p><strong>Marca/Línea:</strong> ${product.sagitario}</p>` : '';
        detailsContent += formatDescription(product.description);
        modalProductDetails.innerHTML = detailsContent;

        const price = Number(product.price);
        const promo = product.promotionalPrice ? Number(product.promotionalPrice) : null;
        modalProductPrice.innerHTML = promo && promo > 0
          ? `<span class="original-price" style="text-decoration: line-through; color: #999; margin-right:10px;">$${price.toFixed(2)}</span><span class="promotional-price" style="color:red; font-weight:bold;">$${promo.toFixed(2)}</span>`
          : `$${price.toFixed(2)}`;

        productModalOverlay.classList.add('open');
      }

      function closeProductModal() {
        productModalOverlay.classList.remove('open');
      }

      async function loadProducts() {
        showSkeleton();
        try {
          const querySnapshot = await getDocs(collection(db, 'products'));
          allProducts = querySnapshot.docs.map(docSnap => docSnap.data());
          isLoading = false;
          applyFilters();
        } catch (error) {
          console.error("Error al cargar productos:", error);
          productsSection.innerHTML = "<p>Error al cargar productos.</p>";
        }
      }

      function flyToCart(imgElement, name, price, image) {
        const rect = imgElement.getBoundingClientRect();
        const cartRect = cartButton.getBoundingClientRect();
        const flyingImg = imgElement.cloneNode(true);
        flyingImg.className = 'flying-img';
        flyingImg.style.top = `${rect.top}px`;
        flyingImg.style.left = `${rect.left}px`;
        flyingImg.style.width = `${rect.width}px`;
        flyingImg.style.height = `${rect.height}px`;
        document.body.appendChild(flyingImg);

        requestAnimationFrame(() => {
          flyingImg.style.transform = `translate(${cartRect.left - rect.left + cartRect.width/2 - rect.width/2}px, ${cartRect.top - rect.top + cartRect.height/2 - rect.height/2}px) scale(0.1)`;
        });

        flyingImg.addEventListener('transitionend', () => {
          flyingImg.remove();
          addToCart(name, price, image);
        }, { once: true });
      }

      updateCartDOM();
      loadProducts();

      searchInput.addEventListener('input', applyFilters);
      brandFilter.addEventListener('change', applyFilters);

      closeProductModalBtn.addEventListener('click', closeProductModal);
      productModalOverlay.addEventListener('click', (e) => { if (e.target === productModalOverlay) closeProductModal(); });

      modalAddToCartBtn.addEventListener('click', () => {
        if (currentModalProduct) {
          const { title, promotionalPrice, price, image } = currentModalProduct;
          const finalPrice = (promotionalPrice && promotionalPrice > 0) ? promotionalPrice : price;
          addToCart(title, Number(finalPrice), image || 'https://via.placeholder.com/150');
          closeProductModal();
        }
      });

      cartButton.addEventListener('click', () => cartModal.classList.toggle('open'));
      closeCartBtn.addEventListener('click', () => cartModal.classList.remove('open'));
      cartItemsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-item')) {
          const index = e.target.getAttribute('data-index');
          cart.splice(index, 1);
          saveCartToLocalStorage();
          updateCartDOM();
          showToast("Producto removido del carrito!");
        }
      });

      checkoutBtn.addEventListener('click', () => {
        if (cart.length === 0) {
          showToast('No hay productos en el carrito.');
          return;
        }
        let message = "Hola, estos son los productos que deseo comprar:%0A";
        cart.forEach(item => {
          message += `- ${item.name} por $${item.price.toFixed(2)}%0A`;
        });
        cart = [];
        saveCartToLocalStorage();
        updateCartDOM();
        window.location.href = `https://wa.me/51938759195?text=${message}`;
      });

      productsSection.addEventListener('click', (e) => {
        const productCard = e.target.closest('.product');
        if (!productCard || productCard.classList.contains('skeleton')) return;

        const index = productCard.getAttribute('data-index');
        currentModalProduct = (index !== null) ? allProducts[index] : null;

        if (e.target.closest('button')) {
          e.stopPropagation();
          const button = e.target.closest('button');
          const name = button.getAttribute('data-name');
          const price = Number(button.getAttribute('data-price'));
          const image = button.getAttribute('data-image');
          const imgElement = productCard.querySelector('img');
          flyToCart(imgElement, name, price, image);
        } else if (currentModalProduct) {
          openProductModal(currentModalProduct);
        }
      });

      const bannerImages = document.querySelectorAll('.banner .banner-image-container img');
      let currentImageIndex = 0;
      setInterval(() => {
        bannerImages[currentImageIndex].classList.remove('active');
        currentImageIndex = (currentImageIndex + 1) % bannerImages.length;
        bannerImages[currentImageIndex].classList.add('active');
      }, 5000);
    </script>
</body>
</html>
